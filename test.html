<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Untitled Document</title>
</head>

<body>

<div id="canvas-container" style="width: 512px; height: 256px;">
    <canvas id="sineCanvas" style="width: 512px; height: 256px;" width="512" height="256"></canvas>
</div>
<button onclick="runCode()">Apply code</button>
<textarea id="inputCode" cols="80" rows="20">
value_output=value_input;
</textarea>

<script>

var inputCode = document.getElementById( 'inputCode' );
var codeText = inputCode.value;

var canvas = document.getElementById("sineCanvas");
var context = canvas.getContext("2d");
context.lineJoin = 'round';
context.save();

var value_input=0;
var value_input_history=[];
var value_output=0;
var value_output_history=[];

var i;
for (i=0;i<256;i++){
	value_input_history[i]=0;
	value_output_history[i]=0;
}

function drawDataSet(dataSet,dataColor){
	context.strokeStyle = dataColor;
	context.beginPath();
    context.moveTo(0, dataSet[0]);   
    // Loop to draw segments
    for (i = 0; i <= 255; i += 1) {
        context.lineTo(i*2, dataSet[i]);
    }	
	context.stroke();
}

function runCode(){
	console.log("run code!");
	codeText = inputCode.value
}


var myVar;

function myFunction() {
	myVar = setInterval(alertFunc, 50);
}

var debug_counter=0;
function alertFunc() {
	//console.log("Hello!");
	var input_value=128+127*Math.sin(debug_counter);
	debug_counter+=Math.PI/128.0;
	value_input_history.shift();
	value_input_history.push(input_value);
	value_input=input_value;
	eval(codeText);
	value_output_history.shift();
	value_output_history.push(value_output);
	context.clearRect(0, 0, 512, 256);
	drawDataSet(value_input_history,'#f00')
	drawDataSet(value_output_history,'#00f')
}

myFunction();



</script>


</body>
</html>
