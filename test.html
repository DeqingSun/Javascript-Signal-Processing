<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>camera signal</title>
<script src="build/tracking.js"></script>
</head>

<body>
<div>
    <div id="canvas-container" style="width: 512px; height: 256px; display:inline-block">
    	<canvas id="sineCanvas" style="width: 512px; height: 256px;" width="512" height="256">	
        </canvas>
    </div>
    <div id="canvas-container2" style="width: 342px; height: 256px; display:inline-block">
    	<video id="camVideo" width="342" height="256" style="position:absolute" preload autoplay loop muted controls></video>
        <canvas id="camCanvas" width="342" height="256" style="position:absolute"></canvas>
    </div>
</div>
<div>
<textarea id="inputCode" cols="80" rows="20">
value_output=value_input;
</textarea>
</div>
<div>
<button onClick="runCode()">Apply code</button>
<p id="eval_result"></p>
</div>
<script>

var inputCode = document.getElementById( 'inputCode' );
var codeText = inputCode.value;

var wavCanvas = document.getElementById("sineCanvas");
var wavContext = wavCanvas.getContext("2d");
wavContext.lineJoin = 'round';
wavContext.save();

var cam_value_input=0;
var value_input=0;
var value_input_history=[];
var value_output=0;
var value_output_history=[];

var i;
for (i=0;i<256;i++){
	value_input_history[i]=0;
	value_output_history[i]=0;
}

function drawDataSet(dataSet,dataColor){
	wavContext.strokeStyle = dataColor;
	wavContext.beginPath();
    wavContext.moveTo(0, dataSet[0]);   
    // Loop to draw segments
    for (i = 0; i <= 255; i += 1) {
        wavContext.lineTo(i*2, dataSet[i]);
    }	
	wavContext.stroke();
}

function runCode(){
	console.log("run code!"); 
	try {
		eval(inputCode.value); 
		document.getElementById("eval_result").innerHTML = "Code applied on "+Date();
		codeText = inputCode.value;
	} catch (e) {
		if (e instanceof SyntaxError) {
			console.log(e.message);
			document.getElementById("eval_result").innerHTML = "Syntax Error. Code not applied";
		}
	}
}


var myVar;

function myFunction() {
	myVar = setInterval(alertFunc, 50);
}

var debug_counter=0;
function alertFunc() {
	//console.log("Hello!");
	var input_value=cam_value_input;
	debug_counter+=Math.PI/128.0;
	value_input_history.shift();
	value_input_history.push(input_value);
	value_input=input_value;
	
	try {
		eval(codeText); 
	} catch (e) {
		if (e instanceof SyntaxError) {
			console.log(e.message);
			document.getElementById("eval_result").innerHTML = "Syntax Error.";
		}
	}
	
	value_output_history.shift();
	value_output_history.push(value_output);
	wavContext.clearRect(0, 0, 512, 256);
	drawDataSet(value_input_history,'#f00')
	drawDataSet(value_output_history,'#00f')
}

myFunction();


window.onload = function() {
  var camVideo = document.getElementById('camVideo');
  var camCanvas = document.getElementById('camCanvas');
  var camcontext = camCanvas.getContext('2d');

  var tracker = new tracking.ColorTracker(['magenta']);

  tracking.track('#camVideo', tracker, { camera: true });

  tracker.on('track', function(event) {
	camcontext.clearRect(0, 0, camCanvas.width, camCanvas.height);

	event.data.forEach(function(rect) {
	  //camcontext.strokeStyle = rect.color;
	  camcontext.strokeStyle = "lime";
	  camcontext.strokeRect(rect.x, rect.y, rect.width, rect.height);
	  //console.log(rect.y+0.5*rect.height);
	  cam_value_input=rect.y+0.5*rect.height;
	});
  });

 //initGUIControllers(tracker);
};


</script>


</body>
</html>
